{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Sign Up | Library</title>
	<link href="{% static 'css/app.css' %}" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

	<!-- Font Awesome for icons -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

	<!-- jQuery -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>

	<style>
		body {
			background: linear-gradient(135deg, #1d2b64, #f8cdda);
			font-family: 'Inter', sans-serif;
			color: #333;
		}

		.card {
			background: white;
			border-radius: 1rem;
			box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
		}

		.card .form-label {
			font-weight: 600;
		}

		.input-group-text {
			background: #f0f0f0;
			border-right: none;
		}

		.form-control:focus {
			border-color: #6c63ff;
			box-shadow: 0 0 0 0.2rem rgba(108, 99, 255, 0.25);
		}

		.btn-outline-primary {
			border-radius: 50px;
			font-weight: bold;
			padding: 10px 30px;
		}

		.email_error, .username_error {
			font-size: 0.9rem;
			display: block;
			margin-top: 5px;
		}
	</style>
</head>
<body>
<main class="d-flex w-100">
	<div class="container d-flex flex-column">
		<div class="row vh-100">
			<div class="col-sm-10 col-md-8 col-lg-6 mx-auto d-table h-100">
				<div class="d-table-cell align-middle">
					<div class="text-center mt-4 text-white">
						<h1 class="h2">Registration Form</h1>
						<p class="lead">Great libraries build communities.</p>
					</div>

					{% if messages %}
					<ul class="alert alert-info">
						{% for message in messages %}
							<li>{{ message }}</li>
						{% endfor %}
					</ul>
					{% endif %}

					<div class="card p-4 mt-3">
						<div class="card-body">
							<form method="post" enctype="multipart/form-data">
								{% csrf_token %}
								{% for field, icon in fields.items %}
								<div class="mb-3">
									<label class="form-label">{{ field.label }}</label>
									<div class="input-group">
										<span class="input-group-text"><i class="{{ icon }}"></i></span>
										{{ field }}
									</div>
								</div>
								{% endfor %}

								<div class="text-center mt-3">
									<button type="submit" class="btn btn-outline-primary mt-4">Register</button>
								</div>
							</form>
							<div id="validation-feedback"></div>
						</div>
					</div>

				</div>
			</div>
		</div>
	</div>
</main>

<script src="{% static 'js/app.js' %}"></script>

<script>
	function getCookie(name) {
		let cookieValue = null;
		if (document.cookie && document.cookie !== '') {
			const cookies = document.cookie.split(';');
			for (let i = 0; i < cookies.length; i++) {
				const cookie = cookies[i].trim();
				if (cookie.substring(0, name.length + 1) === (name + '=')) {
					cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
					break;
				}
			}
		}
		return cookieValue;
	}
	const csrftoken = getCookie('csrftoken');

	$(document).ready(function(){
		$("#id_email").keyup(function(){
			let email = $(this).val();
			if(email){
				$.ajax({
					url: "{% url 'check_email_exist' %}",
					type: "POST",
					headers: { "X-CSRFToken": csrftoken },
					data: { email: email },
					success: function(response){
						$(".email_error").remove();
						let color = response.exists ? "red" : "green";
						let msg = response.exists ? "Email Not Available" : "Email Available";
						$(`<span class='email_error' style='color:${color}; font-weight:bold;'>${msg}</span>`).insertAfter("#id_email");
					}
				});
			} else {
				$(".email_error").remove();
			}
		});

		$("#id_username").keyup(function(){
			let username = $(this).val();
			if(username){
				$.ajax({
					url: "{% url 'check_username_exist' %}",
					type: "POST",
					headers: { "X-CSRFToken": csrftoken },
					data: { username: username },
					success: function(response){
						$(".username_error").remove();
						let color = response.exists ? "red" : "green";
						let msg = response.exists ? "Username Not Available" : "Username Available";
						$(`<span class='username_error' style='color:${color}; font-weight:bold;'>${msg}</span>`).insertAfter("#id_username");
					}
				});
			} else {
				$(".username_error").remove();
			}
		});
	});
</script>
</body>
</html>
